<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>ATM Simulator</title>
        <link rel="stylesheet" href="style.css">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    </head>
    <body>
        <header class="atm-header">
            <h1>SecureBank ATM</h1>
        </header>
        <h2>ATM Simulator withdraw-amount</h2><br><br>
        <h3>Enter user details : </h3><br>
        <br><br>
        <form id="withdraw-form" hidden>
            <label for="withdaw-account-number">Account Number:</label>
            <input type="text" id="withdaw-account-number" name="withdaw-account-number" required>
            <br><br>
            <label for="pin">PIN:</label>
            <input type="password" id="pin" name="pin" required>
            <br><br>
            <label for="amount">Amount to Withdraw:</label>
            <input type="number" id="amount" name="amount" required>
            <br><br>
            <label for="balance">Current Balance</label>
            <p id="balance">Loading...</p>
            <button type="submit">Withdraw</button>
        </form>
        <form id="account-form">
            <label for="display-account-number">Account Number:</label>
            <input type="text" id="display-account-number" name="display-account-number" required>
            <br><br>
            <button type="button" id="check-balance">Check Balance</button>
            <br><br>
            <p id="balance">Current Balance: Not checked yet</p>
        </form>
    </body>
    <script>
        document.getElementById('withdraw-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent the form from submitting normally
    
            const accountNumber = document.getElementById('account-number').value;
            const pin = document.getElementById('pin').value;
            const amount = parseFloat(document.getElementById('amount').value);
    
            try {
                const response = await fetch(`/withdraw/${accountNumber}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pin: pin,
                        amount: amount
                    })
                });
    
                const result = await response.json();

                document.getElementById('balance').textContent = `New Balance: ${result.updatedBalance}`;
    
                if (response.ok) {
                    alert(`✅ Withdrawal successful! \nNew Balance: ${result.updatedBalance}`);
                } else {
                    alert(`❌ Error: ${result.error}`);
                }
    
            } catch (error) {
                console.error('Error:', error);
                alert('❌ An error occurred while processing your request.');
            }
        });

        document.getElementById('check-balance').addEventListener('click', async function() {
            const accountNumber = document.getElementById('account-number').value;
    
            try {
                const response = await fetch(`/balance/${accountNumber}`);
                const result = await response.json();
    
                if (response.ok) {
                    document.getElementById('balance').textContent = `Current Balance: ${result.balance}`;
                    document.getElementById('withdraw-form').hidden = false; // Show the withdraw form
                } else {
                    alert(`❌ Error: ${result.error}`);
                }
    
            } catch (error) {
                console.error('Error:', error);
                alert('❌ An error occurred while checking the balance.');
            }
        });
    </script>
    
</html>